# nginx configuration file for Data Fair development and test environment

server {
  listen 6218;
  server_name _;

  # web socket support
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "Upgrade";
  
  # redirect root to /metrics/
  location = / {  
    return 302 /metrics/;
  }

  location /metrics/api/ {
    proxy_pass http://localhost:6219/;
  }

  location /metrics/ {
    proxy_pass http://localhost:6220;
  }

  location /simple-directory {
    rewrite  ^/simple-directory/(.*) /$1 break;
    proxy_pass http://localhost:6221/;
  }
  location /mails {
    rewrite  ^/mails/(.*) /$1 break;
    proxy_pass http://localhost:1080/;
  }

  location /data-fair {
    rewrite  ^/data-fair/(.*) /$1 break;
    proxy_pass http://localhost:6222/;
  }
}