{
  "type": "object",
  "additionalProperties": false,
  "title": "the query parameters of the daily-api-metrics/_agg endpoint",
  "required": ["start", "end"],
  "properties": {
    "start": {
      "type": "string",
      "format": "date"
    },
    "end": {
      "type": "string",
      "format": "date"
    },
    "statusClass": {
      "type": "string",
      "enum": ["info", "ok", "redirect", "clientError", "serverError"]
    },
    "userClass": {
      "type": "string",
      "num": [        "anonymous",        "owner",        "external",        "ownerAPIKey",        "externalAPIKey",        "ownerProcessing",
        "externalProcessing"
      ]
    }
  }
}

if (query.start) $match.day = { ...$match.day, $gte: query.start }
if (query.end) $match.day = { ...$match.day, $lte: query.end }
if (query.statusClass) $match.statusClass = query.statusClass
if (query.userClass) $match.userClass = query.userClass
if (query.operationTrack) $match.operationTrack = query.operationTrack
if (query.resourceType) $match['resource.type'] = query.resourceType
if (query.resourceId) $match['resource.id'] = query.resourceId
if (query.processingId) $match['processing._id'] = query.resourceId